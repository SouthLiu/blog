# 第一节 进程的描述
### 操作系统中最核心的概念是`进程`，操作系统的其他所有内容都是围绕进程展开的。

### 程序并发执行的特点：
1. 程序顺序执行。早期无操作系统及单道批处理系统的计算机中，程序的执行方式都是典型的顺序执行。先进入内存的程序先执行，在一个程序执行完毕之前，不能执行其他程序。程序中的指令也是依照程序的控制流依次执行，一条指令执行完毕之前不能开始执行另外一条指令。程序顺序执行时具有以下特点：
   1. `顺序性`。处理机的操作，严格按照程序所规定的顺序执行，即只有前一操作结束后，才能执行后续操作。
   2. `封闭性`。程序在封闭的环境下运行的。程序一旦开始运行，其结束不受外界因素的影响。
   3. `可再现性`。只要程序执行时的环境和初始条件相同，当程序多次重复执行时，其执行结果相同。
2. 程序的并发执行。程序并发执行是指在同一时间间隔内运行多个程序。一个程序执行结束之前，可以运行其他程序。对用户而言，看到的是计算机同时运行多个程序。程序并发执行的确切含义是从宏观上，用户看到多个程序同时向前不间断地推进。而从微观上，任意时刻一个CPU上只有一个程序在执行。在现代单CPU或多CPU的计算机中，支持多任务及支持多任务的操作系统都能够有效管理和支持程序的并发执行。多道程序系统和分时系统都允许用户程序在计算机系统中并发执行，程序并发执行具有以下几个特点：
   1. `间断性`。每个程序在CPU上运行，都是时断时续的。当请求某个资源的程序数量大于请求的资源数量时，就必然有因申请不到资源而暂停执行的程序。当其他程序释放资源后，该程序才可能继续执行。资源的有限使并发执行的程序呈现执行过程的间断性。
   2. `失去封闭性`。程序在并发执行时，由于它们共享资源或者合作完成同一项任务，系统的状态不再是只有正在执行的某一个程序可以“看见”和改变。
   3. `不可再现性`。程序在并发执行时，由于失去了封闭性，也将导致其失去执行结果的可再现性。同一个程序在输入完全相同的情况下多次运行，可能出现不同的运行结果。

### 进程的特征：
1. `并发性`。多个进程实体能在一段时间间隔内同时执行。并发性是进程和现代操作系统的重要特征。
2. `动态性`。进程是进程实体的执行过程。进程的动态性表现在因执行程序而创建进程、因获得CPU而执行进程的指令、因运行终止而被撤销的动态变化过程。
3. `独立性`。在没有引入线程概念的操作系统中，进程是独立运行和资源调度的基本单位。
4. `异步性`。异步性是指进程的执行时断时续，进程什么时候执行、什么时候暂停都无法预知，呈现一种随机的特征。
5. `结构特征`。进程实体包括`用户正文段`、`用户数据段`和`进程控制块`。

### 进程与程序的区别：
1. 程序是静态的，进程是动态的。程序是存储在某种介质上的二进制代码，进程对应了程序执行的过程，系统不需要为一个不执行的程序创建进程，一旦进程被创建，就处于不断变化的动态过程中，对应了一个不断变化的上下文环境。
2. 程序是永久的，进程是暂时存在的。程序的永久性是相对于进程而言的，只要程序的拥有者不去删除它，程序可以永久地存在于磁盘、U盘等外存储介质中。进程因程序的执行而被创建，因程序执行的结束而被撤销，有一个相对短暂的生命期。
3. 程序与进程的存在实体不同。`程序是指令的集合`，而`进程包括了正文段、用户数据段和进程控制块的实体`。

### 进程与程序的联系：
1. 进程是程序的一次执行，进程总是对应至少一个特定的程序，执行程序的代码。
2. 一个程序可以对应多个进程。同一个程序可以在不同的数据集合上运行，因而构成若干个不同的进程。几个进程能并发地执行相同的程序代码，而同一个进程能顺序地执行几个程序。

### 不同操作系统进程控制块中包含的描述信息不完全相同，一般操作系统中的进程控制块中通常包含`进程标识符信息`、`处理机状态信息`、`进程调度信息`和`进程控制信息`。

### 进程控制块中保留的处理机状态信息：
1. 通用寄存器。
2. 指令计数器。
3. 程序状态字PSW。
4. 用户栈指针。

### 进程的3种基本状态：`就绪态`、`执行态`和`阻塞态`。


### 进程状态不能由阻塞态进入`执行态`，进程状态由阻塞态变成就绪态的过程称为`唤醒过程`，由执行态变成阻塞态的过程称为`阻塞过程`。
### 需要创建进程的情况：
1. 用户登录。在交互系统中，当一个新用户登录系统时会创建进程。
2. 作业调度。当把位于外存存储器中的作业调入内存准备运行时，操作系统会为作业的运行创建进程。
3. 提供服务。操作系统可以创建一个进程，代表用户程序的执行某种功能，用户无需等待。
4. 应用请求。当用户发出执行某程序的命令，或者用户程序在执行中基于并行的要求在程序中显式调用进程创建的系统调用时，都会引起进程的创建。

### 在Linux系统中，除了`0号进程(swapper进程)`外的其他进程都是由其父进程创建的。

### 与进程创建密切相关的函数有`execve()`，与其对应的系统调用是sys_execve()，主要功能是使进程执行新的程序代码。

### 操作系统可能进行进程的阻塞和唤醒操作的情况：
1. 请求系统服务。
2. 启动某种操作。
3. 新数据尚未到达。对于一个计算进程，如果新的输入数据还没有到达，计算进程进入阻塞队列。
4. 无新工作可做。发送消息之后等待时。

### 进程唤醒的过程：
1. 将进程从阻塞队列中移出。
2. 将进程的状态由阻塞态改为就绪态。
3. 将进程插入就绪队列。

### 进程被终止的情况：
1. 当进程正常执行完毕，调用终止进程的系统调用，请求操作系统删除进程。
2. 一个进程调用适当的系统调用，终止另外一个进程。通常，操作系统规定只允许父进程通过这种方式终止其子进程。

### 如果是选择磁盘启动，计算机会检查硬盘的`0柱0磁道1扇区`，如果发现该删除以`0xAA55`结束，则BIOS认为它是引导扇区，一旦发现引导扇区，BIOS会执行出现将其装入到内存地址0000：7c00处，然后跳转到该地址执行这段引导程序代码，开始加载操作系统。

# 第三节 操作系统内核

### 资源管理包括`进程管理`、`存储器管理`和`设备管理`。

### 进程中断类型：
1. `同步中断`(内部中断或异常)。同步中断是当前指令执行时由CPU控制单元产生的，之所以称为同步，是因为只有在一条指令终止执行后CPU才会发出中断，如除法出错、调试、溢出和浮点出错等。
2. `异步中断`(外部中断)。异步中断是由其他硬件设备随机产生的。在Intel微处理器手册中，把同步中断和异步中断分别称为异常(Exeption)和中断(Interrupt)。Linux中采用这种分类，有时也用术语“中断信号”来表示这两种类型的中断(同步中断及异步中断)。

### 大部分PC中有两个时钟源，分别称为`实时时钟(RTC)`和`OS时钟`。RTC时钟也称CMOS时钟，是一块时钟芯片，靠`电池`供电，为计算机提供计时标准，是最原始、最底层的数据，OS时钟产生于PC主板上的定时/计数芯片，在开机时有效，由`操作系统控制`。

### `系统调用`是系统程序与用户程序之间的接口。

### 在类UNIX系统中，系统调用多使用`C语言提供的库函数`作为接口。

### 系统调用的类型：
1. `进程控制类系统调用`。创建、撤销进程，获得、改变进程属性。
2. `文件操纵类系统调用`。创建文件、删除文件、打开文件、关闭文件和读/写文件。
3. `设备管理类系统调用`。请求、释放设备。
4. `通信类系统调用`。打开、关闭连接，交换信息。

# 第四讲 进程同步
### 同步机制应遵循的准则：
1. `空闲让进`。
2. `忙则等待`。
3. `有限等待`。
4. `让权等待`。

### `自旋锁`是用来在多处理器环境中工作的一种特殊的锁。如果内核控制路径发现自旋锁“开着”，就是相应的整形信号量的值`大于0`，就获取锁并继续自己的执行。相反，如果内核控制路径发现锁由运行在另外一个CPU上的内核控制路径“锁着”，即整型信号量的值`等于0或者小于0`，就反复执行一条紧凑的循环指令，直到锁被释放。

### 整型信号量的值只能包括由`wait`和`signal`操作改变。